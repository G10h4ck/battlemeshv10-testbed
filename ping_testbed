#!/bin/sh
. scripts/functions_wbm.sh

FILE="${1:-./routers}"
USE_TEST_NETWORK="$2"		# <empty> or 'true'
log "using file '$FILE'"

LIST_FAILED=
BAD=0
GOOD=0

while read -r LINE
do
	IP="$LINE"
	[ -n "$USE_TEST_NETWORK" ] && IP="$( convert_management2test_ip "$IP" )"

	if ping_ok "$IP"; then
		GOOD=$(( GOOD + 1 ))
	else
		BAD=$(( BAD + 1 ))
		LIST_FAILED="$LIST_FAILED $IP"
	fi
done <"$FILE"

log "GOOD: $GOOD BAD: $BAD routers"
for IP in $LIST_FAILED; do
	log "failed IP: '$IP'"
done
